<!DOCTYPE html>
<html>
<head>
    <title>Export Test</title>
    <style>
        canvas { border: 1px solid #ccc; }
        .test-results { margin: 20px 0; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Export Functionality Test</h1>
    <canvas id="test-canvas" width="800" height="600"></canvas>
    <div>
        <button onclick="testPNGExport()">Test PNG Export</button>
        <button onclick="testSVGExport()">Test SVG Export</button>
        <button onclick="testCSSExport()">Test CSS Export</button>
    </div>
    <div id="results" class="test-results"></div>

    <script>
        // Setup test canvas with a simple gradient
        const canvas = document.getElementById('test-canvas');
        const ctx = canvas.getContext('2d');
        
        // Draw a test gradient
        const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
        gradient.addColorStop(0, '#ff6b6b');
        gradient.addColorStop(0.33, '#4ecdc4');
        gradient.addColorStop(0.66, '#45b7d1');
        gradient.addColorStop(1, '#f7dc6f');
        
        ctx.fillStyle = gradient;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        
        function log(message, isError = false) {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = isError ? 'error' : 'success';
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
        }
        
        function testPNGExport() {
            try {
                log('Testing PNG export...');
                
                // Simulate the PNG export process from export.js
                const tempCanvas = document.createElement('canvas');
                const tempCtx = tempCanvas.getContext('2d');
                
                const width = 1920;
                const height = 1080;
                tempCanvas.width = width;
                tempCanvas.height = height;
                
                // Draw the current canvas content to temp canvas
                tempCtx.drawImage(canvas, 0, 0, width, height);
                
                // Test toBlob functionality
                tempCanvas.toBlob((blob) => {
                    if (blob) {
                        log('PNG export successful - blob size: ' + blob.size + ' bytes');
                        
                        // Test download creation
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'test-gradient-export.png';
                        
                        log('PNG download link created successfully');
                        
                        // Actually trigger download for manual verification
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);
                        
                        log('PNG download triggered');
                    } else {
                        log('PNG export failed - no blob created', true);
                    }
                }, 'image/png');
                
            } catch (error) {
                log('PNG export error: ' + error.message, true);
            }
        }
        
        function testSVGExport() {
            try {
                log('Testing SVG export...');
                
                // Simulate SVG generation
                const svgContent = `<svg width="1920" height="1080" xmlns="http://www.w3.org/2000/svg">
    <defs>
        <radialGradient id="grad1" cx="20%" cy="20%" r="80%">
            <stop offset="0%" style="stop-color:#ff6b6b;stop-opacity:1" />
            <stop offset="33%" style="stop-color:#4ecdc4;stop-opacity:1" />
            <stop offset="66%" style="stop-color:#45b7d1;stop-opacity:1" />
            <stop offset="100%" style="stop-color:#f7dc6f;stop-opacity:1" />
        </radialGradient>
    </defs>
    <rect width="100%" height="100%" fill="url(#grad1)" />
</svg>`;
                
                const blob = new Blob([svgContent], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'test-gradient-export.svg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log('SVG export successful - size: ' + blob.size + ' bytes');
                
            } catch (error) {
                log('SVG export error: ' + error.message, true);
            }
        }
        
        function testCSSExport() {
            try {
                log('Testing CSS export...');
                
                const cssContent = `/* Gradient Background Styles */
.gradient-background {
    background: linear-gradient(-45deg, #ff6b6b, #4ecdc4, #45b7d1, #f7dc6f);
    background-size: 400% 400%;
    animation: gradientShift 8s ease infinite;
}

@keyframes gradientShift {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}`;
                
                const blob = new Blob([cssContent], { type: 'text/css' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = 'test-gradient-styles.css';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                log('CSS export successful - size: ' + blob.size + ' bytes');
                
            } catch (error) {
                log('CSS export error: ' + error.message, true);
            }
        }
        
        // Automatic test on load
        window.addEventListener('load', () => {
            log('Export test page loaded successfully');
            log('Canvas context available: ' + (ctx ? 'YES' : 'NO'));
            log('Blob API available: ' + (window.Blob ? 'YES' : 'NO'));
            log('URL.createObjectURL available: ' + (window.URL && window.URL.createObjectURL ? 'YES' : 'NO'));
        });
    </script>
</body>
</html>